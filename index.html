<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Daily Goal Tracker</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#0a0a0a">
  <style>
    /* iOSでのタップ遅延対策（ボタン反応改善） */
    button, input, textarea { touch-action: manipulation; }
  </style>
</head>
<body class="bg-neutral-950 text-white min-h-screen">
  <main class="max-w-md mx-auto px-4 pb-24 pt-6">
    <header class="mb-6">
      <h1 class="text-2xl font-bold tracking-tight">Daily Goal Tracker</h1>
      <p class="text-neutral-400 text-sm mt-1">今日の目標に対する進捗をサクッと管理</p>
    </header>

    <!-- 目標設定 -->
    <section class="mb-6 p-4 rounded-xl bg-neutral-900/70 border border-neutral-800">
      <h2 class="font-semibold mb-3">目標金額</h2>
      <div class="flex gap-2">
        <input id="goalInput" type="number" inputmode="numeric" min="0" step="100"
               class="w-full rounded-lg bg-neutral-800 border border-neutral-700 px-3 py-2"
               placeholder="例: 10000">
        <button id="setGoalBtn"
                class="shrink-0 rounded-lg px-4 py-2 bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 transition">
          設定
        </button>
      </div>
      <p id="goalView" class="text-neutral-300 text-sm mt-2">未設定</p>
    </section>

    <!-- 合計表示＆進捗バー -->
    <section class="mb-6 p-4 rounded-xl bg-neutral-900/70 border border-neutral-800">
      <div class="flex items-end justify-between">
        <div>
          <p class="text-neutral-400 text-sm">現在の合計</p>
          <p id="totalView" class="text-4xl font-extrabold tabular-nums">¥0</p>
        </div>
        <div class="text-right">
          <p class="text-neutral-400 text-sm">達成率</p>
          <p id="percentView" class="text-xl font-bold">0%</p>
        </div>
      </div>
      <div class="mt-3 h-3 w-full bg-neutral-800 rounded-full overflow-hidden">
        <div id="progressBar" class="h-full bg-emerald-500" style="width:0%"></div>
      </div>
      <p id="remainingView" class="text-neutral-300 text-sm mt-2">目標未設定</p>
    </section>

    <!-- Amazon +137円 カウンター -->
    <section class="mb-6 p-4 rounded-xl bg-neutral-900/70 border border-neutral-800">
      <h2 class="font-semibold mb-3">Amazon（+137円/タップ）</h2>
      <div class="flex items-center justify-between">
        <p class="text-neutral-300">配達個数：<span id="amazonCount" class="font-bold">0</span> 回</p>
        <button id="amazonPlusBtn"
                class="rounded-lg px-4 py-3 bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 transition">
          +137円
        </button>
      </div>
    </section>

    <!-- フードデリバリー 金額入力 -->
    <section class="mb-6 p-4 rounded-xl bg-neutral-900/70 border border-neutral-800">
      <h2 class="font-semibold mb-3">フードデリバリー（手動入力）</h2>
      <div class="flex gap-2">
        <input id="fdInput" type="number" inputmode="decimal" min="0" step="1"
               class="w-full rounded-lg bg-neutral-800 border border-neutral-700 px-3 py-2"
               placeholder="金額（円）を入力">
        <button id="fdAddBtn"
                class="shrink-0 rounded-lg px-4 py-2 bg-sky-600 hover:bg-sky-500 active:bg-sky-700 transition">
          追加
        </button>
      </div>
    </section>

    <!-- リセット -->
    <section class="p-4 rounded-xl bg-neutral-900/70 border border-neutral-800">
      <h2 class="font-semibold mb-3">1日の締め</h2>
      <button id="resetBtn"
              class="w-full rounded-lg px-4 py-3 bg-red-600 hover:bg-red-500 active:bg-red-700 transition">
        本日のデータをリセット
      </button>
      <p id="dateView" class="text-neutral-500 text-xs mt-2"></p>
    </section>
  </main>

  <script>
    // ========== ユーティリティ ==========
    const fmtJPY = new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 });
    const todayKey = () => {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `DGT:${y}-${m}-${day}`; // 日付別に保存
    };

    function loadState() {
      const raw = localStorage.getItem(todayKey());
      if (!raw) {
        return { goal: 0, total: 0, amazonCount: 0 };
      }
      try { return JSON.parse(raw); } catch { return { goal: 0, total: 0, amazonCount: 0 }; }
    }

    function saveState(s) {
      localStorage.setItem(todayKey(), JSON.stringify(s));
    }

    function updateUI() {
      const { goal, total, amazonCount } = state;
      document.getElementById('goalView').textContent = goal > 0 ? `目標：${fmtJPY.format(goal)}` : '未設定';
      document.getElementById('totalView').textContent = fmtJPY.format(total);
      document.getElementById('amazonCount').textContent = amazonCount;

      let percent = 0;
      if (goal > 0) percent = Math.min(100, Math.floor((total / goal) * 100));
      document.getElementById('percentView').textContent = `${percent}%`;
      document.getElementById('progressBar').style.width = `${percent}%`;

      if (goal <= 0) {
        document.getElementById('remainingView').textContent = '目標未設定';
      } else if (total >= goal) {
        document.getElementById('remainingView').textContent = `達成！ +${fmtJPY.format(total - goal)}（超過）`;
      } else {
        document.getElementById('remainingView').textContent = `あと ${fmtJPY.format(goal - total)}`;
      }

      const d = todayKey().split(':')[1];
      document.getElementById('dateView').textContent = `保存日：${d}（日付ごとに自動保存）`;
    }

    // ========== 初期化 ==========
    let state = loadState();
    updateUI();

    // ========== 目標設定 ==========
    document.getElementById('setGoalBtn').addEventListener('click', () => {
      const v = parseInt(document.getElementById('goalInput').value, 10);
      state.goal = Number.isFinite(v) && v >= 0 ? v : 0;
      saveState(state);
      document.getElementById('goalInput').value = '';
      updateUI();
    });

    // ========== Amazon +137 ==========
    const STEP = 137;
    document.getElementById('amazonPlusBtn').addEventListener('click', () => {
      state.total += STEP;
      state.amazonCount += 1;
      saveState(state);
      updateUI();
    });

    // ========== フードデリバリー手動追加 ==========
    document.getElementById('fdAddBtn').addEventListener('click', () => {
      const raw = document.getElementById('fdInput').value.trim();
      const v = Number(raw);
      if (!Number.isFinite(v) || v <= 0) {
        alert('0円より大きい数値を入力してください。');
        return;
      }
      state.total += Math.floor(v);
      saveState(state);
      document.getElementById('fdInput').value = '';
      updateUI();
    });

    // Enterキーで追加
    document.getElementById('fdInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('fdAddBtn').click();
    });

    // ========== リセット ==========
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (!confirm('本日のデータ（目標・合計・Amazon回数）をリセットします。よろしいですか？')) return;
      state = { goal: 0, total: 0, amazonCount: 0 };
      saveState(state);
      updateUI();
    });

    // ========== 端末回転などでの再描画 ==========
    window.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        state = loadState(); // 他タブで更新された場合に追従
        updateUI();
      }
    });
  </script>
</body>
</html>
